<!DOCTYPE html>
<html lang="ja" data-theme="dark">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>マスキングツール</title>
    <link rel="stylesheet" href="style.css?v=1" />
</head>

<body>
    <div class="container">
        <header class="header">
            <div>
                <h1>Word / PowerPoint / Excel マスキングツール</h1>
            </div>

            <div class="headerActions">
                <button id="readmeBtn" type="button" class="btn">📘 README</button>
                <button id="themeToggle" type="button" class="btn">🌓 テーマ切替</button>
            </div>
        </header>

        <div class="card">
            <section>
                <label for="fileInput">マスキングするファイル（.docx / .pptx / .xlsx）を選択してください。</label>
                <input type="file" id="fileInput" class="fileInputHidden" accept=".docx,.pptx,.xlsx" />

                <div class="row" style="margin-top:6px;">
                    <label id="filePickBtn" for="fileInput" class="btn">ファイルを選択</label>
                    <span id="fileName" class="fileName">未選択</span>
                </div>
            </section>

            <section style="margin-top:16px;">
                <label>マスキング対象文字列（固定文字列・正規表現不可）</label>
                <p class="mini">追加した文字列はブラウザのローカルストレージに保存されます。</p>

                <div class="tableWrap" style="margin-top:10px;">
                    <table id="maskTable">
                        <thead>
                            <tr>
                                <th style="width:60px;"></th>
                                <th style="width:90px;">処理</th>
                                <th>マスキングする文字列</th>
                                <th style="width:90px;">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- JSで描画 -->
                        </tbody>
                    </table>
                </div>

                <div class="row" style="margin-top:12px;">
                    <button id="addRowBtn" type="button" class="btn">＋ 行を追加</button>
                    <div class="spacer"></div>
                    <button id="resetRulesBtn" type="button" class="btn danger">マスキングルール初期化</button>
                </div>
                <button id="runBtn" type="button" class="btn primary">マスキング実行</button>
            </section>
        </div>

        <footer>
            ©株式会社コンフィック
        </footer>
    </div>

    <!-- README Dialog -->
    <dialog id="readmeDialog" class="modal">
        <div class="modalCard">
            <div class="modalHeader">
                <h2>README</h2>
                <div class="modalActions">
                    <button id="readmeCopyBtn" type="button" class="btn">コピー</button>
                    <button id="readmeCloseBtn" type="button" class="btn">閉じる</button>
                </div>
            </div>

            <!-- MarkdownはここにHTMLとして描画される -->
            <div id="readmeBody" class="readmeBody markdown"></div>
        </div>
    </dialog>

    <!-- README本文（Markdownをそのまま埋め込み） -->
    <script type="text/plain" id="readmeContent">
# マスキングツール README（Word / PowerPoint / Excel）

このツールは、**Officeファイル（.docx / .pptx / .xlsx）内の「固定文字列」**を、指定したマスク文字（`■`）で置換してダウンロードする **ブラウザ完結型**のマスキングツールです。  
（ルールはブラウザの **localStorage** に保存されます）

---

## 特徴

- 対応形式：**.docx / .pptx / .xlsx**
- マスキング方式：**固定文字列のみ**（正規表現不可）
- ルール管理：行追加・削除・有効/無効・ドラッグで並び替え
- 出力ファイル名：元ファイル名 + `_マスキング`（例：`sample_マスキング.docx`）
- ローカル処理：アップロード先サーバ不要（ファイルは基本的に手元のブラウザ内で処理）

---

## 使い方

1. `index.html` をブラウザで開く  
2. 「ファイルを選択」から **.docx / .pptx / .xlsx** を選ぶ  
3. 「マスキング対象文字列」に、隠したい文字列を登録（必要なら行追加）  
4. 対象行の「処理」チェックが ON になっていることを確認  
5. 「マスキング実行」→ `_マスキング` 付きでダウンロード  

---

## ルールの仕様

- **完全一致（固定文字列）で置換**します。部分一致も起きます。  
  - 例：ルールが `田中` の場合、`田中太郎` の `田中` 部分もマスクされます。
- ルールは **長い文字列が優先**されるように処理します（長い順に置換）
- ルールはブラウザの **localStorage** に保存されます（端末・ブラウザごと）
- 「マスキングルール初期化」で localStorage を削除して初期ルールに戻します

---

# ⚠ 注意事項：できないこと（重要）

運用で事故が起きやすいポイントなので、先に“できないこと”を明記します。

## 1) 正規表現・あいまい一致はできません
- **正規表現は非対応**です（例：`[0-9]{4}`、`.*` などはそのまま文字として扱われます）
- 大文字小文字無視、表記ゆれ吸収（全角/半角、スペース差など）も **基本できません**

## 2) Word（.docx）の「document.xml 以外」は対象外です
この実装は **`word/document.xml` のみ**を処理します。  
そのため、たとえば以下は **マスクされない可能性が高い**です：

- ヘッダー/フッター
- 脚注・文末脚注
- コメント、変更履歴
- テキストボックス、図形内テキスト、SmartArt
- 目次・フィールド結果・埋め込みオブジェクト など

> 「本文は消えたのに、ヘッダーに残ってた」みたいな事故が起きがちなので、**仕上げに必ず全体検索**してください。

## 3) PowerPoint（.pptx）は「スライド本文のテキストボックス中心」、それ以外は対象外です
スライドは `ppt/slides/slide*.xml` を対象にしています。  
そのため、以下は **マスクされない可能性が高い**です：

- ノート（スピーカーノート）
- スライドマスター / レイアウト / テーマ側の文字
- 図形やグラフ、SmartArt、埋め込みExcel内の文字
- 画像として貼られた文字（スクショ/ラスタライズ）
- コメント

## 4) Excel（.xlsx）は「文字列として格納されているテキスト中心」、数値・計算式は弱いです
処理対象は主に以下です：

- `xl/sharedStrings.xml`（共有文字列）
- `inlineStr`（セル内のインライン文字列）

そのため、以下は **マスクされない可能性があります**：

- **数値セル**（電話番号やIDを数値で入れている等）
- 数式（式そのもの／計算結果の持ち方によっては対象外）
- コメント、図形、グラフ、ヘッダー/フッター、ピボットなど
- 画像化された文字

## 5) パスワード保護・暗号化されたOfficeファイルは扱えません
（ZIPとして展開できない/中身のXMLにアクセスできないため）

## 6) 完全な「見た目の保持」を保証しません
このツールは **文字の置換**が目的です。通常は崩れにくい設計ですが、ファイル内容やOfficeの内部構造次第で、以下が起こり得ます：

- 一部の改行・空白・特殊文字の扱いが想定とズレる
- Office側で再解釈され、表示が微妙に変わる可能性

## 7) “漏れゼロ”はこのツール単体では保証できません
Officeは格納場所が多彩なので、**別領域に同じ文字が残る**ことがあります。  
**マスク後ファイルで必ず全体検索（Ctrl+F）**、可能なら**目視確認**もしてください。

---

## セキュリティ/プライバシーについて

- ルールは **localStorage** に保存されます（同じPCでもブラウザを変えると別）
- 共有PCでは「ルール初期化」やブラウザデータ削除を推奨

---

## 依存関係・配置

- `index.html` / `main.js` / `style.css`
- `lib/jszip.min.js` が必要（同梱前提の読み込みになっています）
- `lib/marked.umd.js` が必要（README整形表示用）

---

## トラブルシューティング（よくあるやつ）

- **「対応形式は .docx / .pptx / .xlsx」**と出る  
  → 拡張子が違う、またはOffice形式ではない可能性。

- **PPTXで「slide*.xml が見つかりません」**  
  → 形式が特殊/破損/別の拡張子の可能性。

- **XLSXで「対象が見つかりませんでした」**  
  → 文字が共有文字列でもinlineStrでもなく、別の持ち方（数値/式/オブジェクト等）の可能性。
    </script>

    <script src="lib/jszip.min.js"></script>
    <script src="lib/marked.umd.js"></script>
    <script src="main.js?v=1"></script>
</body>

</html>